<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <link rel="apple-touch-icon" href="obr-logo.png">

    <title>DETECTOR-OBR</title> 
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-core"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-converter"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection"></script>

    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="loading-overlay">
        <div id="loading-content">
            <div id="loading-text">INICIANDO DETECTOR OBR</div>
            <div id="loading-bar-container">
                <div id="loading-bar"></div>
            </div>
        </div>
    </div>

    <div id="app-ui"> 

        <div id="left-panel-container" onclick="handlePanelClick(event)">
            <div class="panel-section">
                <div class="section-title">SENSORES</div>
                <div class="sensor-status-grid">
                    <div class="status-light-group" id="mic-status" data-status="off">
                        <div class="status-led-indicator"></div>
                        <div class="emoji">üéôÔ∏è</div>
                        <span>MIC</span>
                    </div>
                    <div class="status-light-group" id="mag-status" data-status="off">
                        <div class="status-led-indicator"></div>
                        <div class="emoji">üß≠</div>
                        <span>MAG</span>
                    </div>
                    <div class="status-light-group" id="prox-status" data-status="off">
                        <div class="status-led-indicator"></div>
                        <div class="emoji">‚ö°</div>
                        <span>EMF</span>
                    </div>
                </div>
                <div id="cam-stats-display">
                    <span id="cam-fps">--</span> FPS<br><span id="cam-res">----</span>p
                </div>
            </div>
            
            <div class="panel-section">
                <div class="section-title">AMBIENTE</div>
                <div id="temp-readout">
                    <div id="temp-val">--.-¬∞C</div>
                </div>
            </div>
        </div>

        <div id="main-view-area" onclick="handleUITap(event)">
            <video id="bg-camera-feed" playsinline autoplay muted></video>
            <canvas id="main-filter-canvas"></canvas>

            <div id="hud-floating-controls" onclick="handleFloatingControlsClick(event)">
                
                <button id="hud-torch-button" onclick="toggleTorch(event)">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M342.6 38.6c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L380.7 167H256c-17.7 0-32 14.3-32 32s14.3 32 32 32h124.7l-83.4 83.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l144-144c12.5-12.5 12.5-32.8 0-45.3l-144-144zM160 80c0-17.7-14.3-32-32-32s-32 14.3-32 32v144H64c-17.7 0-32 14.3-32 32s14.3 32 32 32h32v144c0 17.7 14.3 32 32 32s32-14.3 32-32V288h32c17.7 0 32-14.3 32-32s-14.3-32-32-32H160V80z"/></svg>
                </button>

                <div id="hud-filter-controls">
                    <button class="filter-btn" onclick="setFilter('vno')">VNO</button>
                    <button class="filter-btn" onclick="setFilter('sls')">SLS</button>
                    <button class="filter-btn" onclick="setFilter('neg')">NEG</button>
                    <button class="filter-btn" id="btn-panel" onclick="togglePanel(event)">PAN</button>
                </div>
            </div>
            
            <div id="hud-persistent-elements">
                <img id="hud-top-logo" src="obr-logo.png" alt="Logo OBR" class="visible">
                
                <div id="follow-container">
                    <div id="follow-text" class="follow-step">S√çGUENOS EN</div>
                    <div id="follow-icons" class="follow-step">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M448 209.9a210.1 210.1 0 0 1 -122.8-39.3V349.4A162.6 162.6 0 1 1 185 188.3V277.2a74.6 74.6 0 1 0 52.2 71.2V0l88 0a121.2 121.2 0 0 0 122.8 122.1v87.8z"/></svg>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M549.7 124.1c-6.3-23.7-24.8-42.3-48.3-48.6C458.8 64 288 64 288 64S117.2 64 74.6 75.5c-23.5 6.3-42 24.9-48.3 48.6-11.4 42.9-11.4 132.3-11.4 132.3s0 89.4 11.4 132.3c6.3 23.7 24.8 42.3 48.3 48.6C117.2 448 288 448 288 448s170.8 0 213.4-11.5c23.5-6.3 42-24.9 48.3-48.6 11.4-42.9 11.4-132.3 11.4-132.3s0-89.4-11.4-132.3zM232 341.5V170.5l145.2 85.5-145.2 85.5z"/></svg>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.8 90.7 226.4 209.3 245V327.7h-63V256h63v-54.6c0-62.2 37-96.5 93.7-96.5 27.1 0 55.5 4.8 55.5 4.8v61h-31.3c-30.8 0-40.4 19.1-40.4 38.7V256h68.8l-11 71.7h-57.8V501C413.3 482.4 504 379.8 504 256z"/></svg>
                    </div>
                    <div id="follow-handle" class="follow-step">@EXPLORACIONESOBR</div>
                </div>
            </div>
        </div>

        <div id="bottom-panel-container" onclick="handlePanelClick(event)">
            <div class="panel-section">
                <div class="section-title">LECTURAS</div>
                <div class="dials-grid">
                    <div id="mag-dial-container" class="dial-container">
                        <div id="compass-needle" class="dial-needle"></div>
                        <div class="dial-label">BR√öJULA</div>
                    </div>
                    <div id="detector-dial-container" class="dial-container">
                        <div id="detector-dial-needle" class="dial-needle"></div>
                        <div class="dial-label">DETECTOR</div>
                    </div>
                    <div id="temp-readout">
                        <div id="temp-val">--.-¬∞C</div>
                        <div class="temp-label">AMBIENTE</div>
                    </div>
                </div>
            </div>
            <div class="panel-section">
                <div class="section-title">SPIRIT-BOX</div>
                <div class="spirit-box-content">
                    <div class="knob-container">
                        <div class="knob-circle" id="knob-power">
                            <div id="pwr-knob-indicator" class="knob-indicator"></div>
                        </div>
                        <div class="knob-label">ENCENDER</div>
                    </div>
                    
                    <div id="activity-graph-container" title="Gr√°fica de Actividad EMF">
                        <canvas id="energy-canvas"></canvas>
                    </div>
                    
                    <div class="volume-control-group">
                        <span class="vol-label">VOL</span>
                        <input type="range" min="0" max="100" value="80" id="vol-slider">
                        <span id="vol-percent" class="vol-label">80%</span>
                    </div>
                </div>
            </div>
        </div>

    </div> <canvas id="temp-canvas" class="hidden-canvas"></canvas>

    <script src="script.js"></script>
    
</body>
</html>
